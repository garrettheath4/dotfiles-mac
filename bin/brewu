#!/usr/bin/env bash

brew update
echo
echo '==> Outdated Packages'
brewOutdated=$(brew outdated --verbose)
echo "$brewOutdated" | sed -E 's|([^ ]+)(.*)|\1\2  -  https://formulae.brew.sh/formula/\1|'

# shellcheck disable=SC2016
echo '==> Outdated Casks (update with `brew cask upgrade`)'
caskOutdated=$(brew cask outdated)
echo "$caskOutdated"

rangBell=no
pleaseUpgradePackages=no
pleaseUpgradeCasks=no

if [ -n "$brewOutdated" ]; then
	if [ "$rangBell" == "no" ]; then
		echo -en '\a'
		rangBell=yes
	fi
	read -p "Some packages are outdated. Upgrade? (Y/n): " -n 1 -r
	if [[ ! $REPLY =~ ^[Nn]$ ]]; then
		pleaseUpgradePackages=yes
	fi
fi

if [ -n "$caskOutdated" ]; then
	if [ "$rangBell" == "no" ]; then
		echo -en '\a'
		rangBell=yes
	fi
	read -p "Some casks are outdated. Upgrade casks? (Y/n): " -n 1 -r
	if [[ ! $REPLY =~ ^[Nn]$ ]]; then
		brew cask upgrade
		pleaseUpgradeCasks=yes
	fi
fi

if [ "$pleaseUpgradePackages" == "yes" ]; then
	brew upgrade
fi

if [ "$pleaseUpgradeCasks" == "yes" ]; then
	brew cask upgrade
fi

