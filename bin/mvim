#!/bin/bash
# Run this script to launch a "mini vim" window
# to quickly paste text into Vim for manipulation

widthChars=60
heightChars=10
posX=741
posY=236
centerXoffsetRight=21
centerYoffsetUp=200
vimexec=/Applications/MacVim.app/Contents/MacOS/Vim

command_exists () {
	type "$1" &> /dev/null;
}

if command_exists system_profiler; then
	resolution="$(system_profiler SPDisplaysDataType | sed -n -e 's/^.*Resolution: \([0-9]* x [0-9]*\).*/\1/p' | tail -n1)"
	resX="$(echo $resolution | sed -n -e 's/\([0-9]*\) x \([0-9]*\)/\1/p')"
	resY="$(echo $resolution | sed -n -e 's/\([0-9]*\) x \([0-9]*\)/\2/p')"
	posX="$(echo $resX/2-$widthChars*8/2+$centerXoffsetRight | bc)"
	posY="$(echo $resY/2-$heightChars*15/2-$centerYoffsetUp | bc)"
fi

if ! command_exists "$vimexec"; then
	echo "Warning: Can't find $vimexec, so using plain 'vim' instead"
	vimexec=vim
fi

"$vimexec" -g "+set co=$widthChars" "+set lines=$heightChars" "+winpos $posX $posY"

# To use Moom to center window instead of manually calculating it
# with system_profiler, use this instead:
#  sleep 0.4
#  osascript -e 'tell application "Moom" to center frontmost window'
