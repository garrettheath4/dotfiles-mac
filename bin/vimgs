#!/bin/bash

usage() {
	echo "Usage: $(basename "$0") gs://bucket/blob.ext"
}

if [ $# -lt 1 ] || [ $# -gt 2 ]; then
	usage 1>&2
	exit 2
fi

uri="$1"
if [ $# -eq 2 ]; then
	uri="gs://${1%,}/$2"
fi

case "$uri" in
	'-?' | -h | -help | --help)
		echo "Opens a Google Cloud Storage URI in Vim."
		echo
		usage
		exit
		;;
	*)
		gcloud storage cat "$uri" | vim -RMn -
		;;
esac
